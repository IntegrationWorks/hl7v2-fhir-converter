#
# (c) Te Whatu Ora, Health New Zealand, 2023
#
# SPDX-License-Identifier: Apache-2.0
#
## pretend AllergyIntolerance from ZCP custom segment
##   - actually for testing use of custom segment COMPONENT in conditions.
---
resourceType: AllergyIntolerance

type_1:
  condition: $zcp32 EQUALS H1 || $zcp32 EQUALS H2
  generateList: false
  expressionType: HL7Spec
  valueOf: $code
  vars:
     zcp32: ZCP.3.2
  constants:
     code: allergy

type_2:
  condition: $zcp32 NOT_EQUALS H1 && $zcp32 NOT_EQUALS H2
  generateList: false
  expressionType: HL7Spec
  valueOf: $code
  vars:
     zcp32: ZCP.3.2
  constants:
     code: intolerance

clinicalStatus:
  valueOf: datatype/CodeableConcept_var
  generateList: true
  expressionType: resource
  constants:
    system: "http://terminology.hl7.org/CodeSystem/allergyintolerance-clinical"
    code: "activeXXX"
    display: "Active"

verificationStatus:
  valueOf: datatype/CodeableConcept_var
  generateList: true
  expressionType: resource
  constants:
    system: "http://terminology.hl7.org/CodeSystem/allergyintolerance-verification"
    code: "confirmed"
    display: "Confirmed"

# field ZCP-4.1 is absent --> LOW
criticality_1:
  condition: $zcp41 NULL
  valueOf: $code
  expressionType: HL7Spec
  constants:
    code: low
  vars:
    zcp41: ZCP.4.1

# field ZCP-4.1 is present --> HIGH
criticality_2:
  condition: $zcp41 NOT_NULL
  valueOf: $code
  expressionType: HL7Spec
  constants:
    code: high
  vars:
    zcp41: ZCP.4.1
